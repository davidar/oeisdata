# Stern's diatomic series \(or Stern\-Brocot sequence\): a\(0\) \= 0, a\(1\) \= 1; for n \> 0: a\(2\*n\) \= a\(n\), a\(2\*n\+1\) \= a\(n\) \+ a\(n\+1\)\.
https://oeis.org/A002487
## JSON
```JSON
[0, 1, 1, 2, 1, 3, 2, 3, 1, 4, 3, 5, 2, 5, 3, 4, 1, 5, 4, 7, 3, 8, 5, 7, 2, 7, 5, 8, 3, 7, 4, 5, 1, 6, 5, 9, 4, 11, 7, 10, 3, 11, 8, 13, 5, 12, 7, 9, 2, 9, 7, 12, 5, 13, 8, 11, 3, 10, 7, 11, 4, 9, 5, 6, 1, 7, 6, 11, 5, 14, 9, 13, 4, 15, 11, 18, 7, 17, 10, 13, 3, 14, 11, 19, 8, 21, 13, 18, 5, 17, 12, 19]
```
## Maple
```Maple
A002487 := proc(n) option remember; if n <= 1 then n elif n mod 2 = 0 then procname(n/2); else procname((n-1)/2)+procname((n+1)/2); fi; end: seq(A002487(n),n=0..91);
A002487 := proc(m) local a,b,n; a := 1; b := 0; n := m; while n>0 do if type(n,odd) then b := a+b else a := a+b end if; n := floor(n/2); end do; b; end proc: seq(A002487(n),n=0..91); # Program adapted from E. Dijkstra, Selected Writings on Computing, Springer, 1982, p. 232. - Igor Urbiha (urbiha(AT)math.hr), Oct 28 2002. Since A007306(n) = a(2*n+1), this program can be adapted for A007306 by replacing b := 0 by b := 1.
A002487 := proc(n::integer) local k; option remember; if n = 0 then 0 elif n=1 then 1 else add(K(k,n-1-k)*procname(n - k), k = 1 .. n) end if end proc:
K := proc(n::integer, k::integer) local KC; if 0 <= k and k <= n and n-k <= 2 then KC:=1; else KC:= 0; end if; end proc: seq(A002487(n),n=0..91); # _Thomas Wieder_, Jan 13 2008
# next Maple program:
a:= proc(n) option remember; `if`(n<2, n,
      (q-> a(q)+(n-2*q)*a(n-q))(iquo(n, 2)))
    end:
seq(a(n), n=0..100);  # _Alois P. Heinz_, Feb 11 2021
fusc := proc(n) local a, b, c; a := 1; b := 0;
    for c in convert(n, base, 2) do
        if c = 0 then a := a + b else b := a + b fi od;
    b end:
seq(fusc(n), n = 0..91); # _Peter Luschny_, Nov 09 2022
Stern := proc(n, u) local k, j, b;
    b := j -> nops({seq(Bits:-Xor(k, j-k), k = 0..j)}):
    ifelse(n=0, 1-u, seq(b(j), j = 2^(n-1)-1..2^n-1-u)) end:
seq(print([n], Stern(n, 1)), n = 0..5); # As shown in the comments.
seq(print([n], Stern(n, 0)), n = 0..5); # As shown in the examples. # _Peter Luschny_, Sep 29 2024
```
## Mathematica
```Mathematica
a[0] = 0; a[1] = 1; a[n_] := If[ EvenQ[n], a[n/2], a[(n-1)/2] + a[(n+1)/2]]; Table[ a[n], {n, 0, 100}] (* end of program *)
```
```Mathematica
Onemore[l_] := Transpose[{l, l + RotateLeft[l]}] // Flatten;
```
```Mathematica
NestList[Onemore, {1}, 5] // Flatten  (*gives [a(1), ...]*) (* Takashi Tokita, Mar 09 2003 *)
```
```Mathematica
ToBi[l_] := Table[2^(n - 1), {n, Length[l]}].Reverse[l]; Map[Length,
```
```Mathematica
Split[Sort[Map[ToBi, Table[IntegerDigits[n - 1, 3], {n, 500}]]]]]  (*give [a(1), ...]*) (* Takashi Tokita, Mar 10 2003 *)
```
```Mathematica
A002487[m_] := Module[{a = 1, b = 0, n = m}, While[n > 0, If[OddQ[n], b = a+b, a = a+b]; n = Floor[n/2]]; b]; Table[A002487[n], {n, 0, 100}] (* _Jean-Fran√ßois Alcover_, Sep 06 2013, translated from 2nd Maple program *)
```
```Mathematica
a[0] = 0; a[1] = 1;
```
```Mathematica
Flatten[Table[{a[2*n] = a[n], a[2*n + 1] = a[n] + a[n + 1]}, {n, 0, 50}]] (* _Horst H. Manninger_, Jun 09 2021 *)
```
```Mathematica
nmax = 100; CoefficientList[Series[x*Product[(1 + x^(2^k) + x^(2^(k+1))), {k, 0, Floor[Log[2, nmax]] + 1}], {x, 0, nmax}], x] (* _Vaclav Kotesovec_, Oct 08 2022 *)
```
## PARI
```PARI
{a(n) = n=abs(n); if( n<2, n>0, a(n\2) + if( n%2, a(n\2 + 1)))};
```
```PARI
fusc(n)=local(a=1,b=0);while(n>0,if(bitand(n,1),b+=a,a+=b);n>>=1);b \\ _Charles R Greathouse IV_, Oct 05 2008
```
```PARI
A002487(n,a=1,b=0)=for(i=0,logint(n,2),if(bittest(n,i),b+=a,a+=b));b \\ _M. F. Hasler_, Feb 12 2017, updated Feb 14 2019
```
## Haskell
```Haskell
a002487 n = a002487_list !! n
a002487_list = 0 : 1 : stern [1] where
   stern fuscs = fuscs' ++ stern fuscs' where
     fuscs' = interleave fuscs $ zipWith (+) fuscs $ (tail fuscs) ++ [1]
   interleave []     ys = ys
   interleave (x:xs) ys = x : interleave ys xs
-- _Reinhard Zumkeller_, Aug 23 2011
```
## R
```R
N <- 50 # arbitrary
a <- 1
for (n in 1:N)
{
  a[2*n    ] = a[n]
  a[2*n + 1] = a[n] + a[n+1]
  a
}
a
# _Yosu Yurramendi_, Oct 04 2014
```
```R
# Given n, compute a(n) by taking into account the binary representation of n
a <- function(n){
  b <- as.numeric(intToBits(n))
  l <- sum(b)
  m <- which(b == 1)-1
  d <- 1
  if(l > 1) for(j in 1:(l-1)) d[j] <- m[j+1]-m[j]+1
  f <- c(0,1)
  if(l > 1) for(j in 3:(l+1)) f[j] <- d[j-2]*f[j-1]-f[j-2]
  return(f[l+1])
} # _Yosu Yurramendi_, Dec 13 2016
```
```R
# computes the sequence as a vector A, rather than function a() as above.
A <- c(1,1)
maxlevel <- 5 # by choice
for(m in 1:maxlevel) {
  A[2^(m+1)] <- 1
  for(k in 1:(2^m-1)) {
    r <- m - floor(log2(k)) - 1
    A[2^r*(2*k+1)] <- A[2^r*(2*k)] + A[2^r*(2*k+2)]
}}
A # _Yosu Yurramendi_, May 08 2018
```
## Scheme
```Scheme
;; An implementation of memoization-macro definec can be found for example in: http://oeis.org/wiki/Memoization
(definec (A002487 n) (cond ((<= n 1) n) ((even? n) (A002487 (/ n 2))) (else (+ (A002487 (/ (- n 1) 2)) (A002487 (/ (+ n 1) 2))))))
;; _Antti Karttunen_, Nov 05 2016
```
## Python
```Python
from functools import lru_cache
@lru_cache(maxsize=None)
def a(n): return n if n<2 else a(n//2) if n%2==0 else a((n - 1)//2) + a((n + 1)//2) # _Indranil Ghosh_, Jun 08 2017; corrected by _Reza K Ghazi_, Dec 27 2021
```
```Python
def a(n):
    a, b = 1, 0
    while n > 0:
        if n & 1:
            b += a
        else:
            a += b
        n >>= 1
    return b
# _Reza K Ghazi_, Dec 29 2021
```
```Python
def A002487(n): return sum(int(not (n-k-1) & ~k) for k in range(n)) # _Chai Wah Wu_, Jun 19 2022
```
## Sage
```Sage
def A002487(n):
    M = [1, 0]
    for b in n.bits():
        M[b] = M[0] + M[1]
    return M[1]
print([A002487(n) for n in (0..91)])
# For a dual see A174980. _Peter Luschny_, Nov 28 2017
```
## Julia
```Julia
using Nemo
function A002487List(len)
    a, A = QQ(0), [0,1]
    for n in 1:len
        a = next_calkin_wilf(a)
        push!(A, denominator(a))
    end
A end
A002487List(91) |> println # _Peter Luschny_, Mar 13 2018
```
## Magma
```Magma
[&+[(Binomial(k, n-k-1) mod 2): k in [0..n]]: n in [0..100]]; // _Vincenzo Librandi_, Jun 18 2019
```
