# Number of derangements of a set of n elements where 2 specific elements cannot appear in each other's positions\.
https://oeis.org/A331007
## JSON
```JSON
[1, 0, 0, 0, 4, 24, 168, 1280, 10860, 101976, 1053136, 11881152, 145510740, 1923678680, 27313300344, 414633520704, 6702860119228, 114974897260440, 2085904412222880, 39909278145297536, 803157866412577956, 16960527261105495192, 375011130469825988680, 8664636644578485432960]
```
## Maple
```Maple
f:=gfun:-rectoproc({(n-4)*a(n) = (n-2)*(n-3)*(a(n-1) + a(n-2)), a(0)=1, a(1)=0, a(2)=0, a(3)=0, a(4)=4}, a(n), remember): map(f,[$0..23]); # _Georg Fischer_, Jun 12 2021
```
## Mathematica
```Mathematica
f[n_] := If[n < 0, 0, Subfactorial[n]];
```
```Mathematica
a[n_] := f[n] + f[n-2] - 2 Sum[Binomial[n-2, k]*f[k]*(n-k-2)!, {k, 0, n-2}];
```
```Mathematica
Table[a[n], {n, 0, 23}] (* _Jean-FranÃ§ois Alcover_, Sep 27 2022, after _Andrew Howroyd_ *)
```
## Python
```Python
def permutation(n):
    permutations = [[]]
    for i in range(1,n + 1):
        new_permutations = []
        for p in permutations:
            for j in range(0, len(p) + 1):
                n = p.copy()
                n.insert(j, i)
                new_permutations.append(n)
        permutations = new_permutations
    return permutations
def check_secret_santa(permutations):
    num_valid = 0
    for perm in permutations:
        valid = True
        for i, p in enumerate(perm):
            if i == p - 1 or (i == 0 and p == 2) or (i == 1 and p == 1):
                valid = False
                break
        if valid:
            num_valid += 1
    return num_valid
```
## PARI
```PARI
a(n) = {if(n<=1, n==0, b(n) + b(n-2) - 2*sum(k=0, n-2, binomial(n-2,k)*b(k)*(n-k-2)!))} \\ _Andrew Howroyd_, Jan 07 2020
```
