# Subfactorial or rencontres numbers, or derangements: number of permutations of n elements with no fixed points\.
https://oeis.org/A000166
## JSON
```JSON
[1, 0, 1, 2, 9, 44, 265, 1854, 14833, 133496, 1334961, 14684570, 176214841, 2290792932, 32071101049, 481066515734, 7697064251745, 130850092279664, 2355301661033953, 44750731559645106, 895014631192902121, 18795307255050944540, 413496759611120779881, 9510425471055777937262]
```
## Maple
```Maple
A000166 := proc(n) option remember; if n<=1 then 1-n else (n-1)*(procname(n-1)+procname(n-2)); fi; end;
a:=n->n!*sum((-1)^k/k!, k=0..n): seq(a(n), n=0..21); # _Zerinvary Lajos_, May 17 2007
ZL1:=[S,{S=Set(Cycle(Z,card>1))},labeled]: seq(count(ZL1,size=n),n=0..21); # _Zerinvary Lajos_, Sep 26 2007
with (combstruct):a:=proc(m) [ZL,{ZL=Set(Cycle(Z,card>=m))},labeled]; end: A000166:=a(2):seq(count(A000166,size=n),n=0..21); # _Zerinvary Lajos_, Oct 02 2007
Z := (x, m)->m!^2*sum(x^j/((m-j)!^2), j=0..m): R := (x, n, m)->Z(x, m)^n: f := (t, n, m)->sum(coeff(R(x, n, m), x, j)*(t-1)^j*(n*m-j)!, j=0..n*m): seq(f(0, n, 1), n=0..21); # _Zerinvary Lajos_, Jan 22 2008
a:=proc(n) if `mod`(n,2)=1 then sum(2*k*factorial(n)/factorial(2*k+1), k=1.. floor((1/2)*n)) else 1+sum(2*k*factorial(n)/factorial(2*k+1), k=1..floor((1/2)*n)-1) end if end proc: seq(a(n),n=0..20); # _Emeric Deutsch_, Feb 23 2008
G(x):=2*exp(-x)/(1-x): f[0]:=G(x): for n from 1 to 26 do f[n]:=diff(f[n-1],x) od: x:=0: seq(f[n]/2,n=0..21); # _Zerinvary Lajos_, Apr 03 2009
seq(simplify(KummerU(-n, -n, -1)), n = 0..23); # _Peter Luschny_, May 10 2022
```
## Mathematica
```Mathematica
a[0] = 1; a[n_] := n*a[n - 1] + (-1)^n; a /@ Range[0, 21] (* _Robert G. Wilson v_ *)
```
```Mathematica
a[0] = 1; a[1] = 0; a[n_] := Round[n!/E] /; n >= 1 (* _Michael Taktikos_, May 26 2006 *)
```
```Mathematica
Range[0, 20]! CoefficientList[ Series[ Exp[ -x]/(1 - x), {x, 0, 20}], x]
```
```Mathematica
dr[{n_,a1_,a2_}]:={n+1,a2,n(a1+a2)}; Transpose[NestList[dr,{0,0,1},30]][[3]] (* _Harvey P. Dale_, Feb 23 2013 *)
```
```Mathematica
a[n_] := (-1)^n HypergeometricPFQ[{- n, 1}, {}, 1]; (* _Michael Somos_, Jun 01 2013 *)
```
```Mathematica
a[n_] := n! SeriesCoefficient[Exp[-x] /(1 - x), {x, 0, n}]; (* _Michael Somos_, Jun 01 2013 *)
```
```Mathematica
Table[Subfactorial[n], {n, 0, 21}] (* _Jean-Fran√ßois Alcover_, Jan 10 2014 *)
```
```Mathematica
RecurrenceTable[{a[n] == n*a[n - 1] + (-1)^n, a[0] == 1}, a, {n, 0, 23}] (* _Ray Chandler_, Jul 30 2015 *)
```
```Mathematica
Subfactorial[Range[0, 20]] (* _Eric W. Weisstein_, Dec 31 2017 *)
```
```Mathematica
nxt[{n_,a_}]:={n+1,a(n+1)+(-1)^(n+1)}; NestList[nxt,{0,1},25][[All,2]] (* _Harvey P. Dale_, Jun 01 2019 *)
```
## PARI
```PARI
{a(n) = if( n<1, 1, n * a(n-1) + (-1)^n)}; /* _Michael Somos_, Mar 24 2003 */
```
```PARI
{a(n) = n! * polcoeff( exp(-x + x * O(x^n)) / (1 - x), n)}; /* _Michael Somos_, Mar 24 2003 */
```
```PARI
{a(n)=polcoeff(sum(m=0,n,m^m*x^m/(1+(m+1)*x+x*O(x^n))^(m+1)),n)} /* _Paul D. Hanna_ */
```
```PARI
A000166=n->n!*sum(k=0,n,(-1)^k/k!) \\ _M. F. Hasler_, Jan 26 2012
```
```PARI
a(n)=if(n,round(n!/exp(1)),1) \\ _Charles R Greathouse IV_, Jun 17 2012
```
## Python
```Python
See Hobson link.
```
```Python
A000166_list, m, x = [], 1, 1
for n in range(10*2):
    x, m = x*n + m, -m
    A000166_list.append(x) # _Chai Wah Wu_, Nov 03 2014
```
## Maxima
```Maxima
s[0]:1$
s[n]:=n*s[n-1]+(-1)^n$
makelist(s[n],n,0,12); /* _Emanuele Munarini_, Mar 01 2011 */
```
## Haskell
```Haskell
a000166 n = a000166_list !! n
a000166_list = 1 : 0 : zipWith (*) [1..]
                       (zipWith (+) a000166_list $ tail a000166_list)
-- _Reinhard Zumkeller_, Dec 09 2012
```
## Magma
```Magma
I:=[0,1]; [1] cat [n le 2 select I[n] else (n-1)*(Self(n-1)+Self(n-2)): n in [1..30]]; // _Vincenzo Librandi_, Jan 07 2016
```
